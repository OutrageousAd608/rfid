#include "fonts.h"
#include "ili9341.h"

// Global cursor position
uint16_t LCD_CurrentX = 0;
uint16_t LCD_CurrentY = 0;

// --- 7x10 Font Data (ASCII 32 to 126) ---
const uint16_t Font7x10_Data[] = {
    // ASCII 32 - 47 (Space and Symbols)
    0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, // Space
    0x0000, 0x0000, 0x0006, 0x005F, 0x0006, 0x0000, 0x0000, // !
    0x0000, 0x0007, 0x0003, 0x0000, 0x0007, 0x0003, 0x0000, // "
    0x0024, 0x007E, 0x0024, 0x007E, 0x0024, 0x0000, 0x0000, // #
    0x0024, 0x002B, 0x006A, 0x0012, 0x0000, 0x0000, 0x0000, // $
    0x0063, 0x0013, 0x0008, 0x0064, 0x0063, 0x0000, 0x0000, // %
    0x0036, 0x0049, 0x0056, 0x0020, 0x0050, 0x0000, 0x0000, // &
    0x0000, 0x0000, 0x0007, 0x0003, 0x0000, 0x0000, 0x0000, // '
    0x0000, 0x001C, 0x0022, 0x0041, 0x0000, 0x0000, 0x0000, // (
    0x0000, 0x0041, 0x0022, 0x001C, 0x0000, 0x0000, 0x0000, // )
    0x0008, 0x002A, 0x001C, 0x002A, 0x0008, 0x0000, 0x0000, // *
    0x0008, 0x0008, 0x003E, 0x0008, 0x0008, 0x0000, 0x0000, // +
    0x0000, 0x0080, 0x0070, 0x0000, 0x0000, 0x0000, 0x0000, // ,
    0x0008, 0x0008, 0x0008, 0x0008, 0x0008, 0x0000, 0x0000, // -
    0x0000, 0x0060, 0x0060, 0x0000, 0x0000, 0x0000, 0x0000, // .
    0x0020, 0x0010, 0x0008, 0x0004, 0x0002, 0x0000, 0x0000, // /

    // ASCII 48 - 57 (Numbers 0-9)
    0x003E, 0x0051, 0x0049, 0x0045, 0x003E, 0x0000, 0x0000, // 0
    0x0000, 0x0042, 0x007F, 0x0040, 0x0000, 0x0000, 0x0000, // 1
    0x0062, 0x0051, 0x0049, 0x0049, 0x0046, 0x0000, 0x0000, // 2
    0x0022, 0x0049, 0x0049, 0x0049, 0x0036, 0x0000, 0x0000, // 3
    0x0018, 0x0014, 0x0012, 0x007F, 0x0010, 0x0000, 0x0000, // 4
    0x002F, 0x0049, 0x0049, 0x0049, 0x0031, 0x0000, 0x0000, // 5
    0x003C, 0x004A, 0x0049, 0x0049, 0x0030, 0x0000, 0x0000, // 6
    0x0001, 0x0071, 0x0009, 0x0005, 0x0003, 0x0000, 0x0000, // 7
    0x0036, 0x0049, 0x0049, 0x0049, 0x0036, 0x0000, 0x0000, // 8
    0x0006, 0x0049, 0x0049, 0x0029, 0x001E, 0x0000, 0x0000, // 9

    // ASCII 58 - 64 (Symbols)
    0x0000, 0x0036, 0x0036, 0x0000, 0x0000, 0x0000, 0x0000, // :
    0x0000, 0x0056, 0x0036, 0x0000, 0x0000, 0x0000, 0x0000, // ;
    0x0008, 0x0014, 0x0022, 0x0041, 0x0000, 0x0000, 0x0000, // <
    0x0014, 0x0014, 0x0014, 0x0014, 0x0014, 0x0000, 0x0000, // =
    0x0041, 0x0022, 0x0014, 0x0008, 0x0000, 0x0000, 0x0000, // >
    0x0002, 0x0001, 0x0051, 0x0009, 0x0006, 0x0000, 0x0000, // ?
    0x0032, 0x0049, 0x0079, 0x0041, 0x003E, 0x0000, 0x0000, // @

    // ASCII 65 - 90 (Uppercase A-Z)
    0x007E, 0x0011, 0x0011, 0x0011, 0x007E, 0x0000, 0x0000, // A
    0x007F, 0x0049, 0x0049, 0x0049, 0x0036, 0x0000, 0x0000, // B
    0x003E, 0x0041, 0x0041, 0x0041, 0x0022, 0x0000, 0x0000, // C
    0x007F, 0x0041, 0x0041, 0x0022, 0x001C, 0x0000, 0x0000, // D
    0x007F, 0x0049, 0x0049, 0x0049, 0x0041, 0x0000, 0x0000, // E
    0x007F, 0x0009, 0x0009, 0x0009, 0x0001, 0x0000, 0x0000, // F
    0x003E, 0x0041, 0x0049, 0x0049, 0x007A, 0x0000, 0x0000, // G
    0x007F, 0x0008, 0x0008, 0x0008, 0x007F, 0x0000, 0x0000, // H
    0x0000, 0x0041, 0x007F, 0x0041, 0x0000, 0x0000, 0x0000, // I
    0x0020, 0x0040, 0x0041, 0x003F, 0x0001, 0x0000, 0x0000, // J
    0x007F, 0x0008, 0x0014, 0x0022, 0x0041, 0x0000, 0x0000, // K
    0x007F, 0x0040, 0x0040, 0x0040, 0x0040, 0x0000, 0x0000, // L
    0x007F, 0x0002, 0x000C, 0x0002, 0x007F, 0x0000, 0x0000, // M
    0x007F, 0x0004, 0x0008, 0x0010, 0x007F, 0x0000, 0x0000, // N
    0x003E, 0x0041, 0x0041, 0x0041, 0x003E, 0x0000, 0x0000, // O
    0x007F, 0x0009, 0x0009, 0x0009, 0x0006, 0x0000, 0x0000, // P
    0x003E, 0x0041, 0x0051, 0x0021, 0x005E, 0x0000, 0x0000, // Q
    0x007F, 0x0009, 0x0019, 0x0029, 0x0046, 0x0000, 0x0000, // R
    0x0046, 0x0049, 0x0049, 0x0049, 0x0031, 0x0000, 0x0000, // S
    0x0001, 0x0001, 0x007F, 0x0001, 0x0001, 0x0000, 0x0000, // T
    0x003F, 0x0040, 0x0040, 0x0040, 0x003F, 0x0000, 0x0000, // U
    0x001F, 0x0020, 0x0040, 0x0020, 0x001F, 0x0000, 0x0000, // V
    0x003F, 0x0040, 0x0038, 0x0040, 0x003F, 0x0000, 0x0000, // W
    0x0063, 0x0014, 0x0008, 0x0014, 0x0063, 0x0000, 0x0000, // X
    0x0007, 0x0008, 0x0070, 0x0008, 0x0007, 0x0000, 0x0000, // Y
    0x0061, 0x0051, 0x0049, 0x0045, 0x0043, 0x0000, 0x0000, // Z

    // ASCII 91 - 96 (Symbols)
    0x0000, 0x007F, 0x0041, 0x0041, 0x0000, 0x0000, 0x0000, // [
    0x0002, 0x0004, 0x0008, 0x0010, 0x0020, 0x0000, 0x0000, // \ (Backslash)
    0x0000, 0x0041, 0x0041, 0x007F, 0x0000, 0x0000, 0x0000, // ]
    0x0004, 0x0002, 0x0001, 0x0002, 0x0004, 0x0000, 0x0000, // ^
    0x0040, 0x0040, 0x0040, 0x0040, 0x0040, 0x0000, 0x0000, // _
    0x0000, 0x0001, 0x0002, 0x0004, 0x0000, 0x0000, 0x0000, // `

    // ASCII 97 - 122 (Lowercase a-z)
    0x0020, 0x0054, 0x0054, 0x0054, 0x0078, 0x0000, 0x0000, // a
    0x007F, 0x0048, 0x0044, 0x0044, 0x0038, 0x0000, 0x0000, // b
    0x0038, 0x0044, 0x0044, 0x0044, 0x0020, 0x0000, 0x0000, // c
    0x0038, 0x0044, 0x0044, 0x0048, 0x007F, 0x0000, 0x0000, // d
    0x0038, 0x0054, 0x0054, 0x0054, 0x0018, 0x0000, 0x0000, // e
    0x0008, 0x007E, 0x0009, 0x0001, 0x0002, 0x0000, 0x0000, // f
    0x000C, 0x0052, 0x0052, 0x0052, 0x003E, 0x0000, 0x0000, // g
    0x007F, 0x0008, 0x0004, 0x0004, 0x0078, 0x0000, 0x0000, // h
    0x0000, 0x0044, 0x007D, 0x0040, 0x0000, 0x0000, 0x0000, // i
    0x0020, 0x0040, 0x0044, 0x003D, 0x0000, 0x0000, 0x0000, // j
    0x007F, 0x0010, 0x0028, 0x0044, 0x0000, 0x0000, 0x0000, // k
    0x0000, 0x0041, 0x007F, 0x0040, 0x0000, 0x0000, 0x0000, // l
    0x007C, 0x0004, 0x0018, 0x0004, 0x0078, 0x0000, 0x0000, // m
    0x007C, 0x0008, 0x0004, 0x0004, 0x0078, 0x0000, 0x0000, // n
    0x0038, 0x0044, 0x0044, 0x0044, 0x0038, 0x0000, 0x0000, // o
    0x007C, 0x0014, 0x0014, 0x0014, 0x0008, 0x0000, 0x0000, // p
    0x0008, 0x0014, 0x0014, 0x0018, 0x007C, 0x0000, 0x0000, // q
    0x007C, 0x0008, 0x0004, 0x0004, 0x0008, 0x0000, 0x0000, // r
    0x0048, 0x0054, 0x0054, 0x0054, 0x0020, 0x0000, 0x0000, // s
    0x0004, 0x003F, 0x0044, 0x0040, 0x0020, 0x0000, 0x0000, // t
    0x003C, 0x0040, 0x0040, 0x0020, 0x007C, 0x0000, 0x0000, // u
    0x001C, 0x0020, 0x0040, 0x0020, 0x001C, 0x0000, 0x0000, // v
    0x003C, 0x0040, 0x0030, 0x0040, 0x003C, 0x0000, 0x0000, // w
    0x0044, 0x0028, 0x0010, 0x0028, 0x0044, 0x0000, 0x0000, // x
    0x000C, 0x0050, 0x0050, 0x0050, 0x003C, 0x0000, 0x0000, // y
    0x0044, 0x0064, 0x0054, 0x004C, 0x0044, 0x0000, 0x0000, // z

    // ASCII 123 - 126 (Final Symbols)
    0x0000, 0x0008, 0x0036, 0x0041, 0x0000, 0x0000, 0x0000, // {
    0x0000, 0x0000, 0x007F, 0x0000, 0x0000, 0x0000, 0x0000, // |
    0x0000, 0x0041, 0x0036, 0x0008, 0x0000, 0x0000, 0x0000, // }
    0x0008, 0x0004, 0x0008, 0x0010, 0x0008, 0x0000, 0x0000  // ~
};

FontDef Font_7x10 = {7, 10, Font7x10_Data};

void LCD_WriteChar(char ch, FontDef font, uint16_t color, uint16_t bgcolor) {
    uint32_t i, j;

    if (ch < 32 || ch > 126) return;

    int char_offset = (ch - 32) * font.width;

    for (i = 0; i < font.width; i++) {
        uint16_t columnData = font.data[char_offset + i];

        for (j = 0; j < font.height; j++) {
            if ((columnData >> j) & 0x01) {
                LCD_DrawPixel(LCD_CurrentX + i, LCD_CurrentY + j, color);
            } else {
                LCD_DrawPixel(LCD_CurrentX + i, LCD_CurrentY + j, bgcolor);
            }
        }
    }
    LCD_CurrentX += font.width;
}

void LCD_WriteString(const char* str, uint16_t x, uint16_t y, FontDef font, uint16_t color, uint16_t bgcolor) {
    LCD_CurrentX = x;
    LCD_CurrentY = y;
    while (*str) {

        if (*str == '\n') {
            LCD_CurrentY += font.height;
            LCD_CurrentX = x;
            str++;
            continue;
        }
        LCD_WriteChar(*str, font, color, bgcolor);
        str++;
    }
}
